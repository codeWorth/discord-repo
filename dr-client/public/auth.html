<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="http://54.67.103.216/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#000000" />
		<meta name="description" content="A list of Discord servers for UCLA students"/>
		<link rel="apple-touch-icon" href="http://54.67.103.216/logo240.png" />
		<link rel="manifest" href="http://54.67.103.216/manifest.json" />
		<title>Discord Repo</title>
	</head>
	<body>
		<noscript>You need to enable JavaScript to run this app.</noscript>

		<div id="good" style="display: none">
			<h1>Success!</h1>
			<h2>You may now close this window.</h2>
		</div>

		<script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-auth.js"></script>
		
		<script type="text/JavaScript">
			const apiUri = "http://54.67.103.216/api/";
			const firebaseConfig = {
				apiKey: "AIzaSyAq4jExyQvsBjrfXnBA1nWkz6xYiR0tdnk",
				authDomain: "discord-repos-292002.firebaseapp.com",
				databaseURL: "https://discord-repos-292002.firebaseio.com",
				projectId: "discord-repos-292002",
				storageBucket: "discord-repos-292002.appspot.com",
				messagingSenderId: "159442402012",
				appId: "1:159442402012:web:950fe62f961bbcee8e5219"
			};
			firebase.initializeApp(firebaseConfig);
			const provider = new firebase.auth.GoogleAuthProvider();
			provider.setCustomParameters({
				"login_hint": "user@ucla.edu"
			});

			firebase.auth().getRedirectResult().then(async result => {
				if (result.user) {
					let url = new URL(window.location.href);
					let guildID = url.searchParams.get("guildID");
					let userIdToken = await firebase.auth().currentUser.getIdToken(true);
					let response = await fetch(
						apiUri + "confirm?" + new URLSearchParams( {"id": userIdToken, "guildID": guildID} ),
						{method: "PUT"}
					);
					if (response.ok) {
						let good = document.getElementById("good");
						good.style.display = "block";
					} else {
						alert("Something went wrong, sorry.");
					}
				} else {
					firebase.auth().signInWithRedirect(provider);
				}
			});

		</script>

	</body>
</html>
